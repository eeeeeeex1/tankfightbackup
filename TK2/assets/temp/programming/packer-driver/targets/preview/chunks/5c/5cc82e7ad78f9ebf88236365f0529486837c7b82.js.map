{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/fort.ts"],"names":["_decorator","Component","Input","input","Node","Vec2","Vec3","Camera","ccclass","property","fort","Mouseposition","onLoad","node","angle","registerMouseEvents","on","EventType","MOUSE_MOVE","onMouseMove","start","changeDirection","update","dt","event","getLocation","worldPosition","getWorldPosition","Camera0","Carmera","getComponent","screenPosition","worldToScreen","x","y","Math","atan2","abs","PI"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAqDC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAAgCC,MAAAA,I,OAAAA,I;AAAyCC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAA8DC,MAAAA,M,OAAAA,M;;;;;;;;;OACxN;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;sBAEjBU,I,WADZF,OAAO,CAAC,MAAD,C,UAGHC,QAAQ,CAACL,IAAD,C,2BAHb,MACaM,IADb,SAC0BT,SAD1B,CACoC;AAAA;AAAA;;AAAA;;AAAA,eAKhCU,aALgC,GAKV,IAAIN,IAAJ,CAAS,CAAT,EAAY,CAAZ,CALU;AAAA;;AAOhCO,QAAAA,MAAM,GAAG;AACL,eAAKC,IAAL,CAAUC,KAAV,GAAkB,CAAlB;AACA,eAAKC,mBAAL;AACH;;AACDA,QAAAA,mBAAmB,GAAG;AAClBZ,UAAAA,KAAK,CAACa,EAAN,CAASd,KAAK,CAACe,SAAN,CAAgBC,UAAzB,EAAqC,KAAKC,WAA1C,EAAuD,IAAvD;AACH;;AAEDC,QAAAA,KAAK,GAAG;AACJ,eAAKC,eAAL;AACH;;AACDC,QAAAA,MAAM,CAACC,EAAD,EAAa,CAAG;;AACdJ,QAAAA,WAAW,CAACK,KAAD,EAAQ;AACvB,eAAKb,aAAL,GAAqBa,KAAK,CAACC,WAAN,EAArB;AACA,eAAKJ,eAAL;AACH;;AACDA,QAAAA,eAAe,GAAG;AACd,cAAIK,aAAa,GAAG,KAAKb,IAAL,CAAUc,gBAAV,EAApB;AACA,cAAIC,OAAO,GAAG,KAAKC,OAAL,CAAaC,YAAb,CAA0BvB,MAA1B,CAAd;AACA,cAAIwB,cAAc,GAAG,IAAIzB,IAAJ,EAArB;AACAsB,UAAAA,OAAO,CAACI,aAAR,CAAsBN,aAAtB,EAAqCK,cAArC;AAEA,cAAME,CAAC,GAAG,KAAKtB,aAAL,CAAmBsB,CAAnB,GAAuBF,cAAc,CAACE,CAAhD;AACA,cAAMC,CAAC,GAAG,KAAKvB,aAAL,CAAmBuB,CAAnB,GAAuBH,cAAc,CAACG,CAAhD,CAPc,CAQd;;AACA,cAAMpB,KAAK,GAAGqB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,GAAL,CAASH,CAAT,CAAX,EAAwBC,IAAI,CAACE,GAAL,CAASJ,CAAT,CAAxB,KAAwC,MAAME,IAAI,CAACG,EAAnD,CAAd,CATc,CAUd;;AACA,cAAIJ,CAAC,GAAG,CAAJ,IAASD,CAAC,GAAG,CAAjB,EAAoB;AAChB,iBAAKpB,IAAL,CAAUC,KAAV,GAAkB,MAAMA,KAAxB;AACH,WAFD,MAGK,IAAIoB,CAAC,GAAG,CAAJ,IAASD,CAAC,GAAG,CAAjB,EAAoB;AACrB,iBAAKpB,IAAL,CAAUC,KAAV,GAAkB,KAAKA,KAAvB;AACH,WAFI,MAGA,IAAIoB,CAAC,GAAG,CAAJ,IAASD,CAAC,GAAG,CAAjB,EAAoB;AACrB,iBAAKpB,IAAL,CAAUC,KAAV,GAAkB,KAAKA,KAAvB;AACH,WAFI,MAGA,IAAIoB,CAAC,GAAG,CAAJ,IAASD,CAAC,GAAG,CAAjB,EAAoB;AACrB,iBAAKpB,IAAL,CAAUC,KAAV,GAAkB,MAAMA,KAAxB;AACH;AACJ;;AA9C+B,O;;;;;iBAGhB,I","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec2, Vec3, instantiate, Collider2D, Contact2DType,CameraComponent, Camera, Canvas } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('fort')\r\nexport class fort extends Component {\r\n\r\n    @property(Node)\r\n    Carmera: Node = null;\r\n\r\n    Mouseposition: Vec2 = new Vec2(0, 0);\r\n\r\n    onLoad() {\r\n        this.node.angle = 0;\r\n        this.registerMouseEvents();\r\n    }\r\n    registerMouseEvents() {\r\n        input.on(Input.EventType.MOUSE_MOVE, this.onMouseMove, this);\r\n    }\r\n\r\n    start() {\r\n        this.changeDirection();\r\n    }\r\n    update(dt: number) { }\r\n    private onMouseMove(event) {\r\n        this.Mouseposition = event.getLocation();\r\n        this.changeDirection();\r\n    }\r\n    changeDirection() {\r\n        let worldPosition = this.node.getWorldPosition();\r\n        let Camera0 = this.Carmera.getComponent(Camera);\r\n        let screenPosition = new Vec3();\r\n        Camera0.worldToScreen(worldPosition, screenPosition);\r\n\r\n        const x = this.Mouseposition.x - screenPosition.x;\r\n        const y = this.Mouseposition.y - screenPosition.y;\r\n        // 计算新的旋转角度\r\n        const angle = Math.atan2(Math.abs(y), Math.abs(x)) * (180 / Math.PI);\r\n        // 应用旋转角度到sprite附属节点\r\n        if (y > 0 && x < 0) {\r\n            this.node.angle = 270 - angle;\r\n        }\r\n        else if (y > 0 && x > 0) {\r\n            this.node.angle = 90 + angle;\r\n        }\r\n        else if (y < 0 && x > 0) {\r\n            this.node.angle = 90 - angle;\r\n        }\r\n        else if (y < 0 && x < 0) {\r\n            this.node.angle = 270 + angle;\r\n        }\r\n    }\r\n}"]}