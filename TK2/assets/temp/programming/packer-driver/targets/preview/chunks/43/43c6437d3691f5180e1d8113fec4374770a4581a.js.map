{"version":3,"sources":["file:///C:/Users/charon/Desktop/TK2/assets/text/enemytank-002/enemytank-002.ts"],"names":["_decorator","Component","RigidBody2D","Vec3","Collider2D","Contact2DType","Vec2","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","Directions","enemytank_002","direction","tanklife","intervalInSeconds","currentspeed","lastChangeTime","timer","lastPosition","EPSILON","pressedKeys","spreadspeed","aitankspeed","lastspeed","sign","signtimer","speedmonitor","speedtime","speedtimer","speedtimermonitor","onLoad","node","position","Date","now","start","changeDirection","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","update","dt","player","parent","getChildByName","console","log","destroy","selfCollider","otherCollider","newDirection","Math","floor","random","x","y","newVelocity","clone","multiplyScalar","speed","rigidBody","linearVelocity"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, Collider2D, Contact2DType, Vec2 } from 'cc';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n//可以实现tank的四个方向的移动 子弹只有四个方向   没有追踪功能\r\n//enemytank的2.0版\r\n//简单的敌人\r\n\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1, 1),\r\n    UPRIGHT: new Vec2(1, 1),\r\n    DOWNLEFT: new Vec2(-1, -1),\r\n    DOWNRIGHT: new Vec2(1, -1)\r\n};\r\n\r\nconst Directions = [\r\n    new Vec2(-1, 0),  // LEFT\r\n    new Vec2(1, 0),   // RIGHT\r\n    new Vec2(0, 1),   // UP\r\n    new Vec2(0, -1),  // DOWN\r\n];\r\n@ccclass('enemytank_002')\r\nexport class enemytank_002 extends Component {\r\n   \r\n    //加速的倍率\r\n    @property\r\n    private speed: number = 2;\r\n\r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n    //坦克生命值\r\n    tanklife: number = 5;\r\n    intervalInSeconds: number = 5;\r\n    currentspeed: Vec2 = new Vec2(0, 0);\r\n\r\n\r\n    private lastChangeTime: number; // 上次位置改变的时间戳\r\n    private timer: number; // 累计经过的时间\r\n\r\n    private lastPosition: Vec3 = new Vec3();\r\n    private readonly EPSILON: number = 0.0001;\r\n    pressedKeys: any;\r\n    spreadspeed: Vec2 = new Vec2(0, 0);\r\n    aitankspeed: Vec2;\r\n\r\n    private lastspeed: Vec2 = new Vec2(0, 0);\r\n    sign : number = 0;\r\n    signtimer: number = 0;\r\n\r\n    speedmonitor : Vec2 = new Vec2(0,0);\r\n    speedtime : number = 0;\r\n    speedtimer : number = 0;\r\n    speedtimermonitor :number = 0;\r\n\r\n    \r\n\r\n\r\n    onLoad() {\r\n        this.lastPosition = this.node.position; // 初始化上次记录的位置为当前位置\r\n        this.lastChangeTime = Date.now(); // 初始化上次位置改变的时间戳为当前时间\r\n        this.timer = 0; // 初始化计时器为0\r\n    }\r\n\r\n    start() {\r\n        //console.log('生成enemytank');\r\n        this.aitankspeed = new Vec2(0, 0);\r\n        this.changeDirection();\r\n\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n\r\n        // 初始化\r\n        this.speedtimer = 0;\r\n        this.speedmonitor = this.currentspeed; // 初始化监视速度\r\n    }\r\n\r\n    update(dt: number) {\r\n        // 检测位置是否改变\r\n        this.timer += dt;\r\n        // 检查是否超过2秒 2秒后自动改变方向\r\n        if (this.timer >= 2) {\r\n            this.timer = 0; // 重置计时器\r\n            this.changeDirection(); // 调用函数\r\n        }\r\n\r\n        //如果玩家被击败 销毁自身 防止报错\r\n        const player = this.node.parent.getChildByName('playertank');\r\n        if(!player) {\r\n            console.log('失败');\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D) {\r\n        this.changeDirection(); // 自定义方法，用于改变坦克的移动方向\r\n    }\r\n\r\n    changeDirection() {\r\n\r\n        let newDirection = Math.floor(Math.random() * 4); // 假设有四个方向\r\n        while (this.lastspeed.x === Directions[newDirection].x && this.lastspeed.y === Directions[newDirection].y) {\r\n            newDirection = Math.floor(Math.random() * 4);\r\n        }\r\n\r\n        let newVelocity = Directions[newDirection].clone().multiplyScalar(this.speed);\r\n        this.rigidBody.linearVelocity = newVelocity;\r\n        this.currentspeed = newVelocity;\r\n\r\n        this.lastspeed = Directions[newDirection].clone();\r\n    }\r\n}\r\n\r\n\r\n"]}