{"version":3,"sources":["file:///C:/Users/charon/Desktop/tankfightbackup/TK2/assets/text/bullet1.ts"],"names":["_decorator","Component","Collider2D","Contact2DType","AudioSource","PlayerController0","ccclass","property","Bullet","life","start","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","onLoad","scheduleDestroy","scheduleOnce","node","destroy","explosionAudio","clip","playOneShot","console","error","selfCollider","otherCollider","isValid","name","playerController0","tanklife","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,W,OAAAA,W;;AAClDC,MAAAA,iB,iBAAAA,iB;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;wBAGjBQ,M,WADZF,OAAO,CAAC,SAAD,C,UAGHC,QAAQ,CAACH,WAAD,C,2BAHb,MACaI,MADb,SAC4BP,SAD5B,CACsC;AAAA;AAAA;;AAAA;;AAAA,eAK1BQ,IAL0B,GAKX,CALW;AAAA;;AAOlCC,QAAAA,KAAK,GAAG;AACJ,cAAIC,QAAQ,GAAG,KAAKC,YAAL,CAAkBV,UAAlB,CAAf;;AACA,cAAIS,QAAJ,EAAc;AACVA,YAAAA,QAAQ,CAACE,EAAT,CAAYV,aAAa,CAACW,aAA1B,EAAyC,KAAKC,cAA9C,EAA8D,IAA9D;AACH;AACJ;;AAEDC,QAAAA,MAAM,GAAG;AACL;AACA,eAAKC,eAAL;AACH;;AAEDA,QAAAA,eAAe,GAAG;AACd;AACA,eAAKC,YAAL,CAAkB,MAAM;AACpB,iBAAKC,IAAL,CAAUC,OAAV,GADoB,CAEpB;;AACA,gBAAI,KAAKC,cAAL,IAAuB,KAAKA,cAAL,CAAoBC,IAA/C,EAAqD;AACjD;AACA,mBAAKD,cAAL,CAAoBE,WAApB,CAAgC,KAAKF,cAAL,CAAoBC,IAApD,EAA0D,CAA1D;AACH,aAHD,MAGO;AACHE,cAAAA,OAAO,CAACC,KAAR,CAAc,eAAd;AACH;AACJ,WATD,EASG,EATH;AAUH;;AAEDV,QAAAA,cAAc,CAACW,YAAD,EAA2BC,aAA3B,EAAsD;AAChE;AACA,eAAKT,YAAL,CAAkB,MAAM;AACpB,gBAAI,CAACQ,YAAY,CAACE,OAAlB,EAA2B,OADP,CACe;;AAEnCF,YAAAA,YAAY,CAACP,IAAb,CAAkBC,OAAlB,GAHoB,CAKpB;;AACA,gBAAI,KAAKC,cAAL,IAAuB,KAAKA,cAAL,CAAoBC,IAA/C,EAAqD;AACjD;AACA,mBAAKD,cAAL,CAAoBE,WAApB,CAAgC,KAAKF,cAAL,CAAoBC,IAApD,EAA0D,CAA1D;AACH,aAHD,MAGO;AACHE,cAAAA,OAAO,CAACC,KAAR,CAAc,eAAd;AACH;;AAED,gBAAIE,aAAa,IAAIA,aAAa,CAACR,IAAd,CAAmBU,IAAnB,KAA4B,YAA7C,IAA4DF,aAAa,CAACR,IAAd,CAAmBU,IAAnB,KAA0B,OAA1F,EAAoG;AAChGF,cAAAA,aAAa,CAACR,IAAd,CAAmBC,OAAnB;AACH,aAFD,MAIK,IAAIO,aAAa,IAAIA,aAAa,CAACR,IAAd,CAAmBU,IAAnB,KAA4B,OAAjD,EAA0D;AAC3D,kBAAIC,iBAAiB,GAAGH,aAAa,CAACR,IAAd,CAAmBP,YAAnB;AAAA;AAAA,yDAAxB;;AAEA,kBAAIkB,iBAAJ,EAAuB;AACnBA,gBAAAA,iBAAiB,CAACC,QAAlB,GAA6BD,iBAAiB,CAACC,QAAlB,GAA6B,CAA1D;AACAP,gBAAAA,OAAO,CAACQ,GAAR,CAAYF,iBAAiB,CAACC,QAA9B;AACA,oBAAID,iBAAiB,CAACC,QAAlB,KAA+B,CAAnC,EACIJ,aAAa,CAACR,IAAd,CAAmBC,OAAnB;AACP,eALD,MAKO;AACHI,gBAAAA,OAAO,CAACC,KAAR,CAAc,6EAAd;AACH;AACJ;AACJ,WA7BD,EA6BG,MA7BH,EAFgE,CA+BpD;AACf;;AAjEiC,O;;;;;iBAGI,I","sourcesContent":["import { _decorator, Component, Collider2D, Contact2DType, AudioSource } from 'cc';\r\nimport { PlayerController0 } from './tank0';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Bullet1')\r\nexport class Bullet extends Component {\r\n\r\n    @property(AudioSource)\r\n    private explosionAudio: AudioSource = null;\r\n\r\n    private life: number = 0;\r\n\r\n    start() {\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n    }\r\n    \r\n    onLoad() {\r\n        // 调用定时销毁方法\r\n        this.scheduleDestroy();\r\n    }\r\n\r\n    scheduleDestroy() {\r\n        // 使用 scheduleOnce 方法，在 5 秒后销毁节点\r\n        this.scheduleOnce(() => {\r\n            this.node.destroy();\r\n            // 检查音频源组件和音频剪辑是否已定义\r\n            if (this.explosionAudio && this.explosionAudio.clip) {\r\n                // 播放音效\r\n                this.explosionAudio.playOneShot(this.explosionAudio.clip, 1);\r\n            } else {\r\n                console.error('音频源组件或音频剪辑未定义');\r\n            }\r\n        }, 10);\r\n    }\r\n\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D) {\r\n        // 确保只处理一次销毁操作\r\n        this.scheduleOnce(() => {\r\n            if (!selfCollider.isValid) return; // 防止已销毁的对象再次操作\r\n\r\n            selfCollider.node.destroy();\r\n\r\n            // 检查音频源组件和音频剪辑是否已定义\r\n            if (this.explosionAudio && this.explosionAudio.clip) {\r\n                // 播放音效\r\n                this.explosionAudio.playOneShot(this.explosionAudio.clip, 1);\r\n            } else {\r\n                console.error('音频源组件或音频剪辑未定义');\r\n            }\r\n\r\n            if (otherCollider && otherCollider.node.name !== 'normalwall' &&otherCollider.node.name!=='tank0' ) {\r\n                otherCollider.node.destroy();\r\n            }\r\n\r\n            else if (otherCollider && otherCollider.node.name === 'tank0') {\r\n                let playerController0 = otherCollider.node.getComponent(PlayerController0);\r\n\r\n                if (playerController0) {\r\n                    playerController0.tanklife = playerController0.tanklife - 1;\r\n                    console.log(playerController0.tanklife);\r\n                    if (playerController0.tanklife === 0)\r\n                        otherCollider.node.destroy();\r\n                } else {\r\n                    console.error(\"PlayerController0 or PlayerController1 component not found on 'tank1' node.\");\r\n                }\r\n            }\r\n        }, 0.0001); // 稍微增加延迟，确保事件处理完毕\r\n    }\r\n\r\n}\r\n"]}