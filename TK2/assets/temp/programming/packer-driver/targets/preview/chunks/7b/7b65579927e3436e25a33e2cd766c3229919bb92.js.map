{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/firedirection1.ts"],"names":["_decorator","Component","Prefab","Input","input","RigidBody2D","instantiate","AudioSource","Vec2","PlayerController1","ccclass","property","firedirection1","lastFireTime","landminelastFireTime","bulletPrefab","direction","currentiondirection","lastdirection","speed","playercontroller1","start","on","EventType","KEY_DOWN","onKeyDown","onKeyDown0","update","playercontroller0","node","parent","getComponent","currentDirection","x","y","onDestroy","off","event","keyCode","now","Date","fireInterval","fireBullet","bullet","shootAudio","clip","playOneShot","console","error","setParent","setPosition","position","rgd","shootPower","clone","linearVelocity","landminefireInterval","putlandmine","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, AudioSource } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController1 } from './tank1';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('firedirection1')\r\nexport class firedirection1 extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n    @property\r\n    shootPower:number=500;//子弹的发射速度\r\n\r\n    //子弹发射间隔\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    //地雷发射间隔\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n    bulletPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    tankPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab:Prefab=null;\r\n\r\n    direction : Vec2= new Vec2(0,0);\r\n    currentiondirection : Vec2= new Vec2(0,0);\r\n    lastdirection : Vec2 = new Vec2(0,-400);\r\n    speed : Vec2 = new Vec2(0,0);\r\n\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller1:PlayerController1 = null ;\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n\r\n    }\r\n\r\n    update(){\r\n        const playercontroller0: PlayerController1 = this.node.parent.getComponent(PlayerController1);\r\n        if( playercontroller0.currentDirection.x!==0|| playercontroller0.currentDirection.y!==0)\r\n            this.currentiondirection = playercontroller0.currentDirection;\r\n        //this.lastdirection=playercontroller0.currentDirection;\r\n    }\r\n    onDestroy(){\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n    }\r\n\r\n\r\n    //检测是否设计j按下 触发fireBullet\r\n    private onKeyDown(event:EventKeyboard) {\r\n        if(event.keyCode===77){\r\n            //console.log(\"鼠标左键已经按下\");\r\n            const now = Date.now();\r\n           if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n            this.fireBullet();\r\n            this.lastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet(){\r\n        //console.log(\"发射子弹\");\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        // 检查音频源组件和音频剪辑是否已定义\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // 播放音效\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('音频源组件或音频剪辑未定义');\r\n        }\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //console.log(this.currentiondirection);\r\n        const rgd =bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2(this.currentiondirection.x * this.shootPower, this.currentiondirection.y * this.shootPower);\r\n\r\n        if(this.speed.x!==0||this.speed.y!==0){\r\n            this.lastdirection=this.speed;\r\n\r\n        }\r\n        if(this.speed.x===0&&this.speed.y===0){\r\n            this.speed=this.lastdirection.clone();\r\n        }\r\n\r\n        rgd.linearVelocity=this.speed;\r\n    }\r\n\r\n\r\n    //检测k是否按下  发射地雷\r\n    private onKeyDown0(event:EventKeyboard) {\r\n        if(event.keyCode===78){\r\n            const now = Date.now();\r\n           if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n            this.putlandmine();\r\n            this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine(){\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //设置子弹实例的具体属性\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]}