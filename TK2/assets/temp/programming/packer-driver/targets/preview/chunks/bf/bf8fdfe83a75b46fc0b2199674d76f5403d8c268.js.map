{"version":3,"sources":["file:///C:/Users/HUAWEI/Desktop/TK2/assets/text/tank1.ts"],"names":["_decorator","Component","SpriteFrame","Input","input","macro","RigidBody2D","Vec2","firedirection1","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","PlayerController1","direction","currentDirection","ZERO","pressedKeys","Set","start","on","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","upSpriteFrame","downSpriteFrame","leftSpriteFrame","rightSpriteFrame","updateSpriteFrame","onDestroy","off","onCollisionEnter","other","self","node","name","destroy","event","has","keyCode","add","updateDirection","delete","newDirection","KEY","up","down","left","right","equals","updateVelocity","stopMove","velocity","clone","multiplyScalar","speed","rigidBody","linearVelocity","firedirection","getComponentInChildren","spriteNode","getChildByName","sprite","getComponent","cc","Sprite","spriteFrame","rightanddownSpriteFrame","rightandupSpriteFrame","leftanddownSpriteFrame","leftandupSpriteFrame"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, BoxCollider2D } from 'cc';\r\nimport { firedirection1 } from './firedirection1'; // 确保正确引入 firedirection0 类\r\nimport { Vec2 } from 'cc';\r\n//import { Bullet } from './Bullet'; // 假设 Bullet 脚本的文件路径和类名为 Bullet\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1, 1),\r\n    UPRIGHT: new Vec2(1, 1),\r\n    DOWNLEFT: new Vec2(-1, -1),\r\n    DOWNRIGHT: new Vec2(1, -1)\r\n};\r\n\r\n@ccclass('PlayerController1')\r\nexport class PlayerController1 extends Component {\r\n    \r\n    @property\r\n    public speed: number =5;\r\n\r\n    @property\r\n    tanklife: number = 5;\r\n\r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n    @property(SpriteFrame)\r\n    private upSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private downSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n     currentDirection: Vec2 = Vec2.ZERO;\r\n    private pressedKeys: Set<number> = new Set<number>();\r\n   \r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        if (this.upSpriteFrame && this.downSpriteFrame && this.leftSpriteFrame && this.rightSpriteFrame) {\r\n            this.updateSpriteFrame();\r\n        }\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n    }\r\n\r\n\r\n    //运动实现模块\r\n    onCollisionEnter (other, self) {\r\n        //console.log('Collision occurred.');\r\n        //console.log('Collision details:', other, self);\r\n\r\n        // 假设与坦克发生了碰撞\r\n        if (other.node.name === 'bullet') {\r\n            this.node.destroy();\r\n            other.node.destroy();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private onKeyDown(event: EventKeyboard) {\r\n        if (!this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.add(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n    }\r\n\r\n    private onKeyUp(event: EventKeyboard) {\r\n        if (this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.delete(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n    }\r\n\r\n    private updateDirection(): void {\r\n        let newDirection = new Vec2(0, 0);\r\n        if (this.pressedKeys.has(macro.KEY.up)) {\r\n            newDirection.add(Direction.UP);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.down)) {\r\n            newDirection.add(Direction.DOWN);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.left)) {\r\n            newDirection.add(Direction.LEFT);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.right)) {\r\n            newDirection.add(Direction.RIGHT);\r\n        }\r\n\r\n        if (!newDirection.equals(this.currentDirection)) {\r\n            this.currentDirection = newDirection;\r\n            this.updateVelocity();\r\n            this.updateSpriteFrame();\r\n        } else if (newDirection.equals(new Vec2(0, 0))) {\r\n            this.stopMove();\r\n        }\r\n    }\r\n\r\n    private updateVelocity() {\r\n        // 计算归一化的速度方向向量\r\n        let velocity = this.currentDirection.clone().multiplyScalar(this.speed);\r\n\r\n        // 打印速度向量的值\r\n\r\n        //console.log(\"当前方向： \", this.direction);\r\n        //console.log(this.tanklife);\r\n        if (this.rigidBody) {\r\n            this.rigidBody.linearVelocity = velocity;\r\n        }\r\n    }\r\n    private stopMove() {\r\n        if (!this.currentDirection.equals(Vec2.ZERO)) {\r\n            this.currentDirection = Vec2.ZERO;\r\n            this.rigidBody.linearVelocity = Vec2.ZERO;\r\n        }\r\n    }\r\n\r\n    private updateSpriteFrame(): void {\r\n        const firedirection:firedirection1 = this.getComponentInChildren(firedirection1);\r\n        const spriteNode = this.node.getChildByName('RenderSprite1');\r\n        const sprite = spriteNode ? spriteNode.getComponent(cc.Sprite) as cc.Sprite : null;\r\n        if (sprite) {\r\n            switch (true) {\r\n                case this.currentDirection.equals(Direction.UP):\r\n                    sprite.spriteFrame = this.upSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWN):\r\n                    sprite.spriteFrame = this.downSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.LEFT):\r\n                    sprite.spriteFrame = this.leftSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.RIGHT):\r\n                    sprite.spriteFrame = this.rightSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNRIGHT):\r\n                    sprite.spriteFrame = this.rightanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPRIGHT):\r\n                    sprite.spriteFrame = this.rightandupSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNLEFT):\r\n                    sprite.spriteFrame = this.leftanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPLEFT):\r\n                    sprite.spriteFrame = this.leftandupSpriteFrame;\r\n                    break;\r\n                default:\r\n                    // 默认情况下，可以保持原状或设置为静止状态的纹理\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}