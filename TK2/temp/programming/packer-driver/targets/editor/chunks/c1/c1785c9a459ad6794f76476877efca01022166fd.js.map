{"version":3,"sources":["file:///C:/Users/53190/Desktop/tankfightbackup/TK2/assets/text/firedirection0.ts"],"names":["_decorator","Component","Prefab","Input","input","RigidBody2D","instantiate","AudioSource","Vec2","PlayerController0","ccclass","property","firedirection0","lastFireTime","landminelastFireTime","direction","currentiondirection","lastdirection","speed","playercontroller0","start","on","EventType","KEY_DOWN","onKeyDown","onKeyDown0","update","node","parent","getComponent","currentDirection","x","y","onDestroy","off","event","keyCode","now","Date","fireInterval","fireBullet","bullet","bulletPrefab","shootAudio","clip","playOneShot","console","error","setParent","setPosition","position","rgd","shootPower","clone","linearVelocity","landminefireInterval","putlandmine","landminePrefab"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAqBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAA4DC,MAAAA,W,OAAAA,W;AAAmBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,W,OAAAA,W;AAC/IC,MAAAA,I,OAAAA,I;;AACAC,MAAAA,iB,iBAAAA,iB;;;;;;;;;;;AAAoC;OACvC;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBX,U;;gCAGjBY,c,WADZF,OAAO,CAAC,gBAAD,C,UAEHC,QAAQ,CAACJ,WAAD,C,UAgBRI,QAAQ,CAACT,MAAD,C,UAGRS,QAAQ,CAACT,MAAD,C,UAGRS,QAAQ,CAACT,MAAD,C,sCAxBb,MACaU,cADb,SACoCX,SADpC,CAC8C;AAAA;AAAA;;AAAA;;AAAA;;AAKpB;AAEtB;AAP0C,eAQ1CY,YAR0C,GAQnB,CARmB;;AAQhB;AARgB;;AAUhB;AAE1B;AAZ0C,eAa1CC,oBAb0C,GAaX,CAbW;;AAaR;AAbQ;;AAeR;AAfQ;;AAAA;;AAAA;;AAAA,eA0B1CC,SA1B0C,GA0BxB,IAAIP,IAAJ,CAAS,CAAT,EAAW,CAAX,CA1BwB;AAAA,eA2B1CQ,mBA3B0C,GA2Bd,IAAIR,IAAJ,CAAS,CAAT,EAAW,CAAX,CA3Bc;AAAA,eA4B1CS,aA5B0C,GA4BnB,IAAIT,IAAJ,CAAS,CAAT,EAAW,CAAC,GAAZ,CA5BmB;AAAA,eA6B1CU,KA7B0C,GA6B3B,IAAIV,IAAJ,CAAS,CAAT,EAAW,CAAX,CA7B2B;AAAA,eAkClCW,iBAlCkC,GAkCI,IAlCJ;AAAA;;AAoC1CC,QAAAA,KAAK,GAAG;AACJhB,UAAAA,KAAK,CAACiB,EAAN,CAASlB,KAAK,CAACmB,SAAN,CAAgBC,QAAzB,EAAkC,KAAKC,SAAvC,EAAiD,IAAjD;AACApB,UAAAA,KAAK,CAACiB,EAAN,CAASlB,KAAK,CAACmB,SAAN,CAAgBC,QAAzB,EAAkC,KAAKE,UAAvC,EAAkD,IAAlD;AAEH;;AAEDC,QAAAA,MAAM,GAAE;AACJ,gBAAMP,iBAAoC,GAAG,KAAKQ,IAAL,CAAUC,MAAV,CAAiBC,YAAjB;AAAA;AAAA,qDAA7C;AACA,cAAIV,iBAAiB,CAACW,gBAAlB,CAAmCC,CAAnC,KAAuC,CAAvC,IAA2CZ,iBAAiB,CAACW,gBAAlB,CAAmCE,CAAnC,KAAuC,CAAtF,EACI,KAAKhB,mBAAL,GAA2BG,iBAAiB,CAACW,gBAA7C,CAHA,CAIJ;AACH;;AACDG,QAAAA,SAAS,GAAE;AACP7B,UAAAA,KAAK,CAAC8B,GAAN,CAAU/B,KAAK,CAACmB,SAAN,CAAgBC,QAA1B,EAAmC,KAAKC,SAAxC,EAAkD,IAAlD;AACApB,UAAAA,KAAK,CAAC8B,GAAN,CAAU/B,KAAK,CAACmB,SAAN,CAAgBC,QAA1B,EAAmC,KAAKE,UAAxC,EAAmD,IAAnD;AACH,SAnDyC,CAsD1C;;;AACQD,QAAAA,SAAS,CAACW,KAAD,EAAsB;AACnC,cAAGA,KAAK,CAACC,OAAN,KAAgB,EAAnB,EAAsB;AAClB;AACA,kBAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;;AACD,gBAAIA,GAAG,GAAG,KAAKxB,YAAX,GAA0B,KAAK0B,YAAL,GAAoB,IAAlD,EAAwD;AACvD,mBAAKC,UAAL;AACA,mBAAK3B,YAAL,GAAoBwB,GAApB;AACC;AACJ;AACJ;;AAEOG,QAAAA,UAAU,GAAE;AAChB;AAEA,gBAAMC,MAAM,GAAGnC,WAAW,CAAC,KAAKoC,YAAN,CAA1B,CAHgB,CAKhB;;AACA,cAAI,KAAKC,UAAL,IAAmB,KAAKA,UAAL,CAAgBC,IAAvC,EAA6C;AACzC;AACA,iBAAKD,UAAL,CAAgBE,WAAhB,CAA4B,KAAKF,UAAL,CAAgBC,IAA5C,EAAkD,CAAlD;AACH,WAHD,MAGO;AACHE,YAAAA,OAAO,CAACC,KAAR,CAAc,eAAd;AACH;;AAEDN,UAAAA,MAAM,CAACO,SAAP,CAAiB,KAAKrB,IAAtB;AACAc,UAAAA,MAAM,CAACQ,WAAP,CAAmB,KAAKtB,IAAL,CAAUuB,QAA7B,EAdgB,CAgBhB;AACA;;AACA,gBAAMC,GAAG,GAAEV,MAAM,CAACZ,YAAP,CAAoBxB,WAApB,CAAX;AACA,eAAKa,KAAL,GAAa,IAAIV,IAAJ,CAAS,KAAKQ,mBAAL,CAAyBe,CAAzB,GAA6B,KAAKqB,UAA3C,EAAuD,KAAKpC,mBAAL,CAAyBgB,CAAzB,GAA6B,KAAKoB,UAAzF,CAAb,CAnBgB,CAqBhB;;AACA,cAAG,KAAKlC,KAAL,CAAWa,CAAX,KAAe,CAAf,IAAkB,KAAKb,KAAL,CAAWc,CAAX,KAAe,CAApC,EAAsC;AAClC;AACA,iBAAKf,aAAL,GAAmB,KAAKC,KAAxB;AAGH;;AACD,cAAG,KAAKA,KAAL,CAAWa,CAAX,KAAe,CAAf,IAAkB,KAAKb,KAAL,CAAWc,CAAX,KAAe,CAApC,EAAsC;AAClC;AACA,iBAAKd,KAAL,GAAW,KAAKD,aAAL,CAAmBoC,KAAnB,EAAX;AACH;;AAEDF,UAAAA,GAAG,CAACG,cAAJ,GAAmB,KAAKpC,KAAxB;AACH,SApGyC,CAsG1C;;;AACQO,QAAAA,UAAU,CAACU,KAAD,EAAsB;AACpC,cAAGA,KAAK,CAACC,OAAN,KAAgB,EAAnB,EAAsB;AAClB,kBAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;;AACD,gBAAIA,GAAG,GAAG,KAAKvB,oBAAX,GAAkC,KAAKyC,oBAAL,GAA4B,IAAlE,EAAwE;AACvE,mBAAKC,WAAL;AACA,mBAAK1C,oBAAL,GAA4BuB,GAA5B;AACC;AACJ;AACJ;;AAEOmB,QAAAA,WAAW,GAAE;AACjB,gBAAMf,MAAM,GAAGnC,WAAW,CAAC,KAAKmD,cAAN,CAA1B;AACAhB,UAAAA,MAAM,CAACO,SAAP,CAAiB,KAAKrB,IAAtB;AACAc,UAAAA,MAAM,CAACQ,WAAP,CAAmB,KAAKtB,IAAL,CAAUuB,QAA7B,EAHiB,CAKjB;AACH;;AAvHyC,O,UAgCnCX,Y;;;;;iBA9B2B,I;;qFAEjC5B,Q;;;;;iBACiB,G;;uFAIjBA,Q;;;;;iBACsB,C;;+FAItBA,Q;;;;;iBAC8B,C;;;;;;;iBAGX,I;;;;;;;iBAGF,I;;;;;;;iBAGI,I","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate ,AudioSource } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController0 } from './tank0'; // 确保正确引入 PlayerController0 类\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('firedirection0')\r\nexport class firedirection0 extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n\r\n    @property\r\n    shootPower:number=500;//子弹的发射速度\r\n\r\n    //子弹发射间隔\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    //地雷发射间隔\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n    @property(Prefab)\r\n    bulletPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    tankPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab:Prefab=null;\r\n\r\n    direction : Vec2= new Vec2(0,0);\r\n    currentiondirection : Vec2= new Vec2(0,0);\r\n    lastdirection : Vec2 = new Vec2(0,-400);\r\n    speed : Vec2 = new Vec2(0,0);\r\n\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller0:PlayerController0 = null ;\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n\r\n    }\r\n\r\n    update(){\r\n        const playercontroller0: PlayerController0 = this.node.parent.getComponent(PlayerController0);\r\n        if( playercontroller0.currentDirection.x!==0|| playercontroller0.currentDirection.y!==0)\r\n            this.currentiondirection = playercontroller0.currentDirection;\r\n        //this.lastdirection=playercontroller0.currentDirection;\r\n    }\r\n    onDestroy(){\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n    }\r\n\r\n\r\n    //检测是否设计j按下 触发fireBullet\r\n    private onKeyDown(event:EventKeyboard) {\r\n        if(event.keyCode===74){\r\n            //console.log(\"鼠标左键已经按下\");\r\n            const now = Date.now();\r\n           if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n            this.fireBullet();\r\n            this.lastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet(){\r\n        //console.log(\"发射子弹\");\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        // 检查音频源组件和音频剪辑是否已定义\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // 播放音效\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('音频源组件或音频剪辑未定义');\r\n        }\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //console.log(this.currentiondirection);\r\n        //设置子弹实例的具体属性\r\n        const rgd =bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2(this.currentiondirection.x * this.shootPower, this.currentiondirection.y * this.shootPower);\r\n\r\n        //console.log( 'this.speed ',this.speed );\r\n        if(this.speed.x!==0||this.speed.y!==0){\r\n            //console.log(\"修改\",this.speed);\r\n            this.lastdirection=this.speed;\r\n\r\n\r\n        }\r\n        if(this.speed.x===0&&this.speed.y===0){\r\n            //console.log(\"为0\");\r\n            this.speed=this.lastdirection.clone();\r\n        }\r\n\r\n        rgd.linearVelocity=this.speed;\r\n    }\r\n\r\n    //检测k是否按下  发射地雷\r\n    private onKeyDown0(event:EventKeyboard) {\r\n        if(event.keyCode===75){\r\n            const now = Date.now();\r\n           if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n            this.putlandmine();\r\n            this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine(){\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //设置子弹实例的具体属性\r\n    }\r\n}\r\n\r\n\r\n"]}