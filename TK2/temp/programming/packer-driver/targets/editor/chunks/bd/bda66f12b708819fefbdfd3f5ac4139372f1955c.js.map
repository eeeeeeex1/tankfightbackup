{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/tank1.ts"],"names":["_decorator","Component","SpriteFrame","Input","input","macro","RigidBody2D","Vec2","firedirection1","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","PlayerController1","moveSpeed","direction","currentDirection","ZERO","pressedKeys","Set","tanklife","start","on","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","upSpriteFrame","downSpriteFrame","leftSpriteFrame","rightSpriteFrame","updateSpriteFrame","onDestroy","off","onCollisionEnter","other","self","node","name","destroy","event","has","keyCode","add","updateDirection","delete","newDirection","KEY","up","down","left","right","equals","updateVelocity","stopMove","velocity","clone","multiplyScalar","magnification","rigidBody","linearVelocity","firedirection","getComponentInChildren","spriteNode","getChildByName","sprite","getComponent","cc","Sprite","spriteFrame","rightanddownSpriteFrame","rightandupSpriteFrame","leftanddownSpriteFrame","leftandupSpriteFrame"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, BoxCollider2D } from 'cc';\r\nimport { firedirection1 } from './firedirection1'; // 确保正确引入 firedirection0 类\r\nimport { Vec2 } from 'cc';\r\n//import { Bullet } from './Bullet'; // 假设 Bullet 脚本的文件路径和类名为 Bullet\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1, 1),\r\n    UPRIGHT: new Vec2(1, 1),\r\n    DOWNLEFT: new Vec2(-1, -1),\r\n    DOWNRIGHT: new Vec2(1, -1)\r\n};\r\n\r\n@ccclass('PlayerController1')\r\nexport class PlayerController1 extends Component {\r\n    \r\n    @property\r\n    public magnification: number =5;\r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n    @property(SpriteFrame)\r\n    private upSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private downSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n    \r\n    moveSpeed: number = 5; // 调整移动速度\r\n\r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n     currentDirection: Vec2 = Vec2.ZERO;\r\n    private pressedKeys: Set<number> = new Set<number>();\r\n    tanklife: number = 5;\r\n\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        if (this.upSpriteFrame && this.downSpriteFrame && this.leftSpriteFrame && this.rightSpriteFrame) {\r\n            this.updateSpriteFrame();\r\n        }\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n    }\r\n\r\n\r\n    //运动实现模块\r\n    onCollisionEnter (other, self) {\r\n        //console.log('Collision occurred.');\r\n        //console.log('Collision details:', other, self);\r\n\r\n        // 假设与坦克发生了碰撞\r\n        if (other.node.name === 'bullet') {\r\n            this.node.destroy();\r\n            other.node.destroy();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private onKeyDown(event: EventKeyboard) {\r\n        if (!this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.add(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n    }\r\n\r\n    private onKeyUp(event: EventKeyboard) {\r\n        if (this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.delete(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n    }\r\n\r\n    private updateDirection(): void {\r\n        let newDirection = new Vec2(0, 0);\r\n        if (this.pressedKeys.has(macro.KEY.up)) {\r\n            newDirection.add(Direction.UP);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.down)) {\r\n            newDirection.add(Direction.DOWN);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.left)) {\r\n            newDirection.add(Direction.LEFT);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.right)) {\r\n            newDirection.add(Direction.RIGHT);\r\n        }\r\n\r\n        if (!newDirection.equals(this.currentDirection)) {\r\n            this.currentDirection = newDirection;\r\n            this.updateVelocity();\r\n            this.updateSpriteFrame();\r\n        } else if (newDirection.equals(new Vec2(0, 0))) {\r\n            this.stopMove();\r\n        }\r\n    }\r\n\r\n    private updateVelocity() {\r\n        // 计算归一化的速度方向向量\r\n        let velocity = this.currentDirection.clone().multiplyScalar(this.moveSpeed);\r\n\r\n\r\n        velocity.multiplyScalar(this.magnification);\r\n        // 打印速度向量的值\r\n    \r\n        //console.log(\"当前方向： \", this.direction);\r\n        if (this.rigidBody) {\r\n            this.rigidBody.linearVelocity = velocity;\r\n        }\r\n    }\r\n    private stopMove() {\r\n        if (!this.currentDirection.equals(Vec2.ZERO)) {\r\n            this.currentDirection = Vec2.ZERO;\r\n            this.rigidBody.linearVelocity = Vec2.ZERO;\r\n        }\r\n    }\r\n\r\n    private updateSpriteFrame(): void {\r\n        const firedirection:firedirection1 = this.getComponentInChildren(firedirection1);\r\n        const spriteNode = this.node.getChildByName('RenderSprite1');\r\n        const sprite = spriteNode ? spriteNode.getComponent(cc.Sprite) as cc.Sprite : null;\r\n        if (sprite) {\r\n            switch (true) {\r\n                case this.currentDirection.equals(Direction.UP):\r\n                    sprite.spriteFrame = this.upSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWN):\r\n                    sprite.spriteFrame = this.downSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.LEFT):\r\n                    sprite.spriteFrame = this.leftSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.RIGHT):\r\n                    sprite.spriteFrame = this.rightSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNRIGHT):\r\n                    sprite.spriteFrame = this.rightanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPRIGHT):\r\n                    sprite.spriteFrame = this.rightandupSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNLEFT):\r\n                    sprite.spriteFrame = this.leftanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPLEFT):\r\n                    sprite.spriteFrame = this.leftandupSpriteFrame;\r\n                    break;\r\n                default:\r\n                    // 默认情况下，可以保持原状或设置为静止状态的纹理\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}