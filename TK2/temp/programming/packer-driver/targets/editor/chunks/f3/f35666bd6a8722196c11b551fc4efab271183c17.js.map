{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/playerfire.ts"],"names":["_decorator","Component","Prefab","Input","input","Node","RigidBody2D","Vec3","instantiate","AudioSource","CameraComponent","Vec2","ccclass","property","playerfire","direction","currentiondirection","lastdirection","speed","lastFireTime","fireInterval","landminelastFireTime","landminefireInterval","fireposition","playercontroller0","start","on","EventType","MOUSE_DOWN","onMouseDown","MOUSE_MOVE","onMouseMove","KEY_DOWN","onKeyDown0","update","onDestroy","off","event","getLocation","getButton","now","Date","fireBullet","bullet","bulletPrefab","shootAudio","clip","playOneShot","console","error","setParent","node","setPosition","position","worldPosition","getWorldPosition","Camera0","Carmera","getComponent","screenPosition","worldToScreen","rgd","x","y","normalize","clone","linearVelocity","keyCode","putlandmine","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, AudioSource, director, CameraComponent, Camera } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController0 } from './tank0';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('playerfire')\r\nexport class playerfire extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n\r\n    @property\r\n    shootPower: number = 500;//�ӵ��ķ����ٶ�\r\n\r\n    @property(Prefab)\r\n    bulletPrefab: Prefab = null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab: Prefab = null;\r\n\r\n    @property(Node)\r\n    Carmera: Node = null;\r\n\r\n    direction: Vec2 = new Vec2(0, 0);\r\n    currentiondirection: Vec2 = new Vec2(0, 0);\r\n    lastdirection: Vec2 = new Vec2(0, -400);\r\n    speed: Vec2 = new Vec2(0, 0);\r\n\r\n    lastFireTime: number = 0; // �ϴη���ʱ��\r\n    fireInterval: number = 0; // ������ʱ�䣬��λ��\r\n\r\n    landminelastFireTime: number = 0; // �ϴη���ʱ��\r\n    landminefireInterval: number = 2; // ������ʱ�䣬��λ��\r\n\r\n    fireposition: Vec2 = new Vec2(0, 0);\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller0: PlayerController0 = null;\r\n\r\n\r\n    start() {\r\n        input.on(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        input.on(Input.EventType.MOUSE_MOVE, this.onMouseMove, this);\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown0, this);\r\n\r\n    }\r\n\r\n    update() {\r\n    }\r\n    onDestroy() {\r\n        input.off(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown0, this);\r\n    }\r\n\r\n    private onMouseMove(event) {\r\n        this.fireposition = event.getLocation();\r\n    }\r\n\r\n    private onMouseDown(event: EventMouse) {\r\n        if (event.getButton() === 0) {\r\n\r\n            const now = Date.now();\r\n            if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n                this.fireBullet();\r\n                this.lastFireTime = now;\r\n                //this.fireposition=event.getLocation();\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet() {\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        //音效模块\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // ������Ч\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('��ƵԴ�������Ƶ����δ����');\r\n        }\r\n        //音效模块\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //鼠标的屏幕坐标获取\r\n        let worldPosition = this.node.getWorldPosition();\r\n        let Camera0 = this.Carmera.getComponent(CameraComponent);\r\n        let screenPosition = new Vec3();\r\n        Camera0.worldToScreen(worldPosition, screenPosition);\r\n\r\n        const rgd = bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2((this.fireposition.x - screenPosition.x), (this.fireposition.y - screenPosition.y));\r\n        this.speed.normalize();\r\n        this.speed.x = this.speed.x * 100;\r\n        this.speed.y = this.speed.y * 100;\r\n\r\n        if (this.speed.x !== 0 || this.speed.y !== 0) {\r\n\r\n            this.lastdirection = this.speed;\r\n        }\r\n        if (this.speed.x === 0 && this.speed.y === 0) {\r\n\r\n            this.speed = this.lastdirection.clone();\r\n        }\r\n        rgd.linearVelocity = this.speed;\r\n    }\r\n\r\n    //���k�Ƿ���  �������\r\n    private onKeyDown0(event: EventKeyboard) {\r\n        if (event.keyCode === 70) {\r\n            const now = Date.now();\r\n            if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n                this.putlandmine();\r\n                this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine() {\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //�����ӵ�ʵ���ľ�������\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}