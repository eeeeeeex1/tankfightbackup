{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/firedirection1.ts"],"names":["_decorator","Component","Prefab","Input","input","RigidBody2D","instantiate","AudioSource","Vec2","PlayerController1","ccclass","property","firedirection1","direction","currentiondirection","lastdirection","speed","lastFireTime","fireInterval","landminelastFireTime","landminefireInterval","playercontroller1","start","on","EventType","KEY_DOWN","onKeyDown","onKeyDown0","update","playercontroller0","node","parent","getComponent","currentDirection","x","y","onDestroy","off","event","keyCode","now","Date","fireBullet","bullet","bulletPrefab","shootAudio","clip","playOneShot","console","error","setParent","setPosition","position","rgd","clone","linearVelocity","putlandmine","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, AudioSource } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController1 } from './tank1';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('firedirection1')\r\nexport class firedirection1 extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n    @property\r\n    shootPower:number=500;//子弹的发射速度\r\n\r\n    @property(Prefab)\r\n    bulletPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    tankPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab:Prefab=null;\r\n\r\n    direction : Vec2= new Vec2(0,0);\r\n    currentiondirection : Vec2= new Vec2(0,0);\r\n    lastdirection : Vec2 = new Vec2(0,-400);\r\n    speed : Vec2 = new Vec2(0,0);\r\n\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller1:PlayerController1 = null ;\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n\r\n    }\r\n\r\n    update(){\r\n        const playercontroller0: PlayerController1 = this.node.parent.getComponent(PlayerController1);\r\n        if( playercontroller0.currentDirection.x!==0|| playercontroller0.currentDirection.y!==0)\r\n            this.currentiondirection = playercontroller0.currentDirection;\r\n        //this.lastdirection=playercontroller0.currentDirection;\r\n    }\r\n    onDestroy(){\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n    }\r\n\r\n\r\n    //检测是否设计j按下 触发fireBullet\r\n    private onKeyDown(event:EventKeyboard) {\r\n        if(event.keyCode===77){\r\n            //console.log(\"鼠标左键已经按下\");\r\n            const now = Date.now();\r\n           if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n            this.fireBullet();\r\n            this.lastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet(){\r\n        //console.log(\"发射子弹\");\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        // 检查音频源组件和音频剪辑是否已定义\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // 播放音效\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('音频源组件或音频剪辑未定义');\r\n        }\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //console.log(this.currentiondirection);\r\n        const rgd =bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2(this.currentiondirection.x * 50, this.currentiondirection.y * 50);\r\n\r\n        if(this.speed.x!==0||this.speed.y!==0){\r\n            this.lastdirection=this.speed;\r\n\r\n        }\r\n        if(this.speed.x===0&&this.speed.y===0){\r\n            this.speed=this.lastdirection.clone();\r\n        }\r\n\r\n        rgd.linearVelocity=this.speed;\r\n    }\r\n\r\n\r\n    //检测k是否按下  发射地雷\r\n    private onKeyDown0(event:EventKeyboard) {\r\n        if(event.keyCode===78){\r\n            const now = Date.now();\r\n           if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n            this.putlandmine();\r\n            this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine(){\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //设置子弹实例的具体属性\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]}