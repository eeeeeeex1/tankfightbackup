{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/enemylandmine.ts"],"names":["_decorator","Collider2D","Component","Contact2DType","PlayerController0","PlayerController1","ccclass","property","enemylandmine","onLoad","scheduleDestroy","scheduleOnce","node","destroy","start","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","selfCollider","otherCollider","isValid","console","log","name","parent","playerController1","tanklife","error","playerController0","onDestroy","off"],"mappings":"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","sourcesContent":["import { __private, _decorator, Collider2D, Component, Contact2DType, EventKeyboard, Input, input, instantiate, Node, Prefab } from 'cc';\r\nimport { PlayerController0 } from './tank0'; // 确保正确引入 PlayerController0 类\r\nimport { PlayerController1 } from './tank1'; // 确保正确引入 PlayerController0 类\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('enemylandmine')\r\nexport class enemylandmine extends Component {\r\n\r\n    onLoad() {\r\n        // 调用定时销毁方法\r\n        this.scheduleDestroy();\r\n    }\r\n\r\n    scheduleDestroy() {\r\n        // 使用 scheduleOnce 方法，在 5 秒后销毁节点\r\n        this.scheduleOnce(() => {\r\n            this.node.destroy();\r\n        }, 10);\r\n    }\r\n\r\n\r\n    start() {\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n    }\r\n\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D) {\r\n        // 确保只处理一次销毁操作\r\n        this.scheduleOnce(() => {\r\n            if (!selfCollider.isValid) return; // 防止已销毁的对象再次操作\r\n\r\n            selfCollider.node.destroy();\r\n\r\n            console.log('地雷触发');\r\n            console.log('踩中地雷的物体',otherCollider.node.name);\r\n            if (otherCollider && otherCollider.node.parent.name !== 'mapboundary'&&otherCollider.node.name!=='tank1'&& otherCollider.node.name!=='tank0'&& otherCollider.node.name!=='enemytank') {\r\n                otherCollider.node.destroy();\r\n            }\r\n            else if (otherCollider && otherCollider.node.name === 'tank1') {\r\n\r\n                let playerController1 = otherCollider.node.getComponent(PlayerController1);\r\n\r\n                if (playerController1) {\r\n                    playerController1.tanklife = playerController1.tanklife - 1;\r\n                    console.log(playerController1.tanklife);\r\n                    if (playerController1.tanklife === 0)\r\n                        otherCollider.node.destroy();\r\n                } else {\r\n                    console.error(\"PlayerController0 or PlayerController1 component not found on 'tank1' node.\");\r\n                }\r\n            }\r\n            else if (otherCollider && otherCollider.node.name === 'tank0') {\r\n\r\n                let playerController0 = otherCollider.node.getComponent(PlayerController0);\r\n\r\n                if (playerController0) {\r\n                    playerController0.tanklife = playerController0.tanklife - 1;\r\n                    console.log(playerController0.tanklife);\r\n                    if (playerController0.tanklife === 0)\r\n                        otherCollider.node.destroy();\r\n                } else {\r\n                    console.error(\"PlayerController0 or PlayerController1 component not found on 'tank1' node.\");\r\n                }\r\n            }\r\n\r\n        }, 0.1); // 稍微增加延迟，确保事件处理完毕\r\n    }\r\n    onDestroy() {\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.off(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}