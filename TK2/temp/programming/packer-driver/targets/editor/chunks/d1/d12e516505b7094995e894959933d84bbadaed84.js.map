{"version":3,"sources":["file:///C:/Users/53190/Desktop/TK2/assets/text/enemytank-001/enemytank-001.ts"],"names":["_decorator","Component","RigidBody2D","Vec3","Collider2D","Contact2DType","Vec2","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","Directions","enemytank_001","direction","tanklife","intervalInSeconds","currentspeed","lastChangeTime","timer","lastPosition","EPSILON","pressedKeys","spreadspeed","aitankspeed","lastspeed","sign","signtimer","speedmonitor","speedtime","speedtimer","speedtimermonitor","onLoad","node","position","Date","now","start","changeDirection","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","update","dt","player","parent","getChildByName","Math","abs","x","Enemy_range","y","normalize","set","console","log","destroy","selfCollider","otherCollider","newDirection","floor","random","newVelocity","clone","multiplyScalar","speed","rigidBody","linearVelocity"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, Collider2D, Contact2DType, Vec2 } from 'cc';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n//可以实现tank的万向追踪 但是子弹是只有四个方向且不会追踪\r\n//enemytank的1.0版\r\n//普通的敌人\r\n\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1, 1),\r\n    UPRIGHT: new Vec2(1, 1),\r\n    DOWNLEFT: new Vec2(-1, -1),\r\n    DOWNRIGHT: new Vec2(1, -1)\r\n};\r\n\r\nconst Directions = [\r\n    new Vec2(-1, 0),  // LEFT\r\n    new Vec2(1, 0),   // RIGHT\r\n    new Vec2(0, 1),   // UP\r\n    new Vec2(0, -1),  // DOWN\r\n];\r\n\r\n@ccclass('enemytank_001')\r\nexport class enemytank_001 extends Component {\r\n   \r\n    //加速的倍率\r\n    @property\r\n    private speed: number = 2;\r\n\r\n    //索敌范围\r\n    @property\r\n    Enemy_range : number = 100;\r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n   \r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n    //坦克生命值\r\n    tanklife: number = 5;\r\n    intervalInSeconds: number = 5;\r\n    currentspeed: Vec2 = new Vec2(0, 0);\r\n\r\n\r\n    private lastChangeTime: number; // 上次位置改变的时间戳\r\n    private timer: number; // 累计经过的时间\r\n\r\n    private lastPosition: Vec3 = new Vec3();\r\n    private readonly EPSILON: number = 0.0001;\r\n    pressedKeys: any;\r\n    spreadspeed: Vec2 = new Vec2(0, 0);\r\n    aitankspeed: Vec2;\r\n\r\n    private lastspeed: Vec2 = new Vec2(0, 0);\r\n    sign: number = 0;\r\n    signtimer: number = 0;\r\n\r\n    speedmonitor : Vec2 = new Vec2(0,0);\r\n    speedtime : number = 0;\r\n    speedtimer : number = 0;\r\n    speedtimermonitor :number = 0;\r\n\r\n\r\n    onLoad() {\r\n        this.lastPosition = this.node.position; // 初始化上次记录的位置为当前位置\r\n        this.lastChangeTime = Date.now(); // 初始化上次位置改变的时间戳为当前时间\r\n        this.timer = 0; // 初始化计时器为0\r\n    }\r\n\r\n    start() {\r\n        //console.log('生成enemytank');\r\n        this.aitankspeed = new Vec2(0, 0);\r\n        this.changeDirection();\r\n\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n\r\n        // 初始化\r\n        this.speedtimer = 0;\r\n        this.speedmonitor = this.currentspeed; // 初始化监视速度\r\n    }\r\n\r\n    update(dt: number) {\r\n        // 检测位置是否改变\r\n\r\n        const player = this.node.parent.getChildByName('playertank');\r\n        if(player){\r\n            if((Math.abs(this.node.position.x - player.position.x) < this.Enemy_range  || Math.abs(this.node.position.y - player.position.y) < this.Enemy_range )&&this.sign===0) {\r\n                this.aitankspeed.x = player.position.x - this.node.position.x;\r\n                this.aitankspeed.y = player.position.y - this.node.position.y;\r\n                this.aitankspeed.normalize();\r\n\r\n                this.changeDirection(); // 调用函数\r\n            }\r\n\r\n            else {\r\n                if (this.node.position.x - this.lastPosition.x > this.EPSILON || this.node.position.y - this.lastPosition.y > this.EPSILON) {\r\n                    // console.log('位置改变');\r\n                    this.lastPosition.set(this.node.position); // 更新记录的位置\r\n                    this.lastChangeTime = Date.now(); // 更新位置改变的时间戳\r\n                    this.timer = 0; // 重置计时器\r\n                }\r\n                else {\r\n                    this.timer += dt;\r\n                    // 检查是否超过2秒\r\n                    if (this.timer >= 3) {\r\n                        this.timer = 0; // 重置计时器\r\n                        this.changeDirection(); // 调用函数\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n        else {\r\n            console.log('失败');\r\n            this.node.destroy();\r\n        }\r\n\r\n\r\n        //碰撞速度修改检测\r\n        if (this.sign === 1) {\r\n            this.signtimer += dt;\r\n            // 检查是否超过2秒\r\n            if (this.signtimer >= 2) {\r\n                this.signtimer = 0; // 重置计时器\r\n                this.sign = 0; \r\n                this.changeDirection() ;\r\n                //console.log('调整完毕');\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D) {\r\n\r\n        this.sign = 1;\r\n        this.changeDirection(); // 自定义方法，用于改变坦克的移动方向\r\n\r\n    }\r\n\r\n    changeDirection() {\r\n\r\n        let newDirection = Math.floor(Math.random() * 4); // 假设有四个方向\r\n        while (this.lastspeed.x === Directions[newDirection].x && this.lastspeed.y === Directions[newDirection].y) {\r\n            newDirection = Math.floor(Math.random() * 4);\r\n        }\r\n\r\n        if ((this.aitankspeed.x !== 0 || this.aitankspeed.y !== 0) && this.sign===0) {\r\n            let newVelocity = this.aitankspeed.clone().multiplyScalar(this.speed);\r\n            //给坦克赋值速度\r\n            this.rigidBody.linearVelocity = newVelocity;\r\n            //传递速度到fire\r\n            this.currentspeed = newVelocity;\r\n\r\n        }\r\n\r\n        else {\r\n\r\n            let newVelocity = Directions[newDirection].clone().multiplyScalar(this.speed);\r\n            this.rigidBody.linearVelocity = newVelocity;\r\n            this.currentspeed = newVelocity;\r\n\r\n            this.lastspeed = Directions[newDirection].clone();\r\n        }\r\n    }\r\n}"]}