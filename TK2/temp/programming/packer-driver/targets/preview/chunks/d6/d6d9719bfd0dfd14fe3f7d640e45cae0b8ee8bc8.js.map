{"version":3,"sources":["file:///C:/Users/53190/Desktop/TK2/assets/text/firedirection1.ts"],"names":["_decorator","Component","Prefab","Input","input","RigidBody2D","instantiate","AudioSource","Vec2","PlayerController1","ccclass","property","firedirection1","lastFireTime","landminelastFireTime","direction","currentiondirection","lastdirection","speed","playercontroller1","start","on","EventType","KEY_DOWN","onKeyDown","onKeyDown0","update","playercontroller0","node","parent","getComponent","currentDirection","x","y","onDestroy","off","event","keyCode","now","Date","fireInterval","fireBullet","bullet","bulletPrefab","shootAudio","clip","playOneShot","console","error","setParent","setPosition","position","rgd","shootPower","clone","linearVelocity","landminefireInterval","putlandmine","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, AudioSource } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController1 } from './tank1';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('firedirection1')\r\nexport class firedirection1 extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n    @property\r\n    shootPower:number=500;//子弹的发射速度\r\n\r\n    //子弹发射间隔\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    //地雷发射间隔\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n    @property(Prefab)\r\n    bulletPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    tankPrefab:Prefab=null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab:Prefab=null;\r\n\r\n    direction : Vec2= new Vec2(0,0);\r\n    currentiondirection : Vec2= new Vec2(0,0);\r\n    lastdirection : Vec2 = new Vec2(0,-400);\r\n    speed : Vec2 = new Vec2(0,0);\r\n\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller1:PlayerController1 = null ;\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.on(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n\r\n    }\r\n\r\n    update(){\r\n        const playercontroller0: PlayerController1 = this.node.parent.getComponent(PlayerController1);\r\n        if( playercontroller0.currentDirection.x!==0|| playercontroller0.currentDirection.y!==0)\r\n            this.currentiondirection = playercontroller0.currentDirection;\r\n        //this.lastdirection=playercontroller0.currentDirection;\r\n    }\r\n    onDestroy(){\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        input.off(Input.EventType.KEY_DOWN,this.onKeyDown0,this);\r\n    }\r\n\r\n\r\n    //检测是否设计j按下 触发fireBullet\r\n    private onKeyDown(event:EventKeyboard) {\r\n        if(event.keyCode===77){\r\n            //console.log(\"鼠标左键已经按下\");\r\n            const now = Date.now();\r\n           if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n            this.fireBullet();\r\n            this.lastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet(){\r\n        //console.log(\"发射子弹\");\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        // 检查音频源组件和音频剪辑是否已定义\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // 播放音效\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('音频源组件或音频剪辑未定义');\r\n        }\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //console.log(this.currentiondirection);\r\n        const rgd =bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2(this.currentiondirection.x * this.shootPower, this.currentiondirection.y * this.shootPower);\r\n\r\n        if(this.speed.x!==0||this.speed.y!==0){\r\n            this.lastdirection=this.speed;\r\n\r\n        }\r\n        if(this.speed.x===0&&this.speed.y===0){\r\n            this.speed=this.lastdirection.clone();\r\n        }\r\n\r\n        rgd.linearVelocity=this.speed;\r\n    }\r\n\r\n\r\n    //检测k是否按下  发射地雷\r\n    private onKeyDown0(event:EventKeyboard) {\r\n        if(event.keyCode===78){\r\n            const now = Date.now();\r\n           if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n            this.putlandmine();\r\n            this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine(){\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //设置子弹实例的具体属性\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]}