{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/enemytank-001/enemyfire.ts"],"names":["_decorator","Component","Prefab","RigidBody2D","instantiate","Vec2","enemytank_001","ccclass","property","enemyfire","lastFireTime","landminelastFireTime","speed","lastdirection","update","dt","fireInterval","fireBullet","landminefireInterval","putlandmine","bullet","bulletPrefab","setParent","node","setPosition","position","tank","parent","getComponent","rgd","currentspeed","x","y","console","log","shootPower","clone","linearVelocity","onKeyDown0","event","now","Date","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { enemytank_001 } from './enemytank-001';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('enemyfire')\r\nexport class enemyfire extends Component {\r\n\r\n    @property\r\n    shootPower: number = 300;//子弹的发射速度\r\n\r\n\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n    @property(Prefab)\r\n    bulletPrefab: Prefab = null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab: Prefab = null;\r\n\r\n\r\n    static fireInterval: number;\r\n\r\n    speed: Vec2 = new Vec2(0, 0);\r\n    lastdirection: Vec2 = new Vec2(0, 0)\r\n\r\n\r\n    update(dt) {\r\n        this.lastFireTime += dt;\r\n        this.landminelastFireTime += dt;\r\n        // 子弹的发射间隔\r\n        if (this.lastFireTime >= this.fireInterval) {\r\n            // 调用发射子弹函数\r\n            this.fireBullet();\r\n            // 重置计时\r\n            this.lastFireTime = 0;\r\n        }\r\n\r\n        //地雷的时间发射间隔\r\n        if (this.landminelastFireTime >= this.landminefireInterval) {\r\n            this.putlandmine(); \r\n            this.landminelastFireTime = 0;\r\n        }\r\n    }\r\n\r\n    private fireBullet() {\r\n        const bullet = instantiate(this.bulletPrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //设置子弹实例的具体属性\r\n        const tank = this.node.parent.getComponent(enemytank_001);\r\n        const rgd = bullet.getComponent(RigidBody2D);\r\n        //如果tank没有捕捉到player 肯定有一个方向为0\r\n        if(tank.currentspeed.x===0||tank.currentspeed.y===0){\r\n            console.log('没有捕捉到');\r\n            this.speed = new Vec2(tank.currentspeed.x * this.shootPower, tank.currentspeed.y * this.shootPower);\r\n        }\r\n        //如果tank捕捉到player 根据关系实现八个方向的射击\r\n        else{\r\n            console.log('捕捉到');\r\n            if(tank.currentspeed.x>0&&tank.currentspeed.y>0){\r\n                this.speed = new Vec2(0.5* this.shootPower, 0.5* this.shootPower);\r\n            }\r\n            if(tank.currentspeed.x<0&&tank.currentspeed.y>0){\r\n                this.speed = new Vec2(-0.5* this.shootPower, 0.5* this.shootPower);\r\n            }\r\n            if(tank.currentspeed.x>0&&tank.currentspeed.y<0){\r\n                this.speed = new Vec2(0.5* this.shootPower, -0.5* this.shootPower);\r\n            }\r\n            if(tank.currentspeed.x<0&&tank.currentspeed.y<0){\r\n                this.speed = new Vec2(-0.5* this.shootPower, -0.5* this.shootPower);\r\n            }\r\n        }\r\n\r\n        if (this.speed.x !== 0 || this.speed.y !== 0) {\r\n            this.lastdirection = this.speed;\r\n        }\r\n        if (this.speed.x === 0 && this.speed.y === 0) {\r\n            this.speed = this.lastdirection.clone();\r\n        }\r\n        rgd.linearVelocity = this.speed;\r\n    }\r\n\r\n    //地雷放置模块\r\n\r\n    private onKeyDown0(event: EventKeyboard) {\r\n        const now = Date.now();\r\n        if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n            this.putlandmine();\r\n            this.landminelastFireTime = now;\r\n        }\r\n    }\r\n\r\n    private putlandmine() {\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n    }\r\n}\r\n\r\n"]}