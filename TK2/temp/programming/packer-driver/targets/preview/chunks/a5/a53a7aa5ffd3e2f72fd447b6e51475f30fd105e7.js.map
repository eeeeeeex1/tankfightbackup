{"version":3,"sources":["file:///C:/Users/HUAWEI/Desktop/TK2/assets/text/playerfire.ts"],"names":["_decorator","Component","Prefab","Input","input","Node","RigidBody2D","Vec3","instantiate","AudioSource","CameraComponent","Vec2","ccclass","property","playerfire","lastFireTime","landminelastFireTime","direction","lastdirection","speed","fireposition","playercontroller0","start","on","EventType","MOUSE_DOWN","onMouseDown","MOUSE_MOVE","onMouseMove","KEY_DOWN","onKeyDown0","update","onDestroy","off","event","getLocation","getButton","now","Date","fireInterval","fireBullet","bullet","bulletPrefab","shootAudio","clip","playOneShot","console","error","setParent","node","setPosition","position","worldPosition","getWorldPosition","Camera0","Carmera","getComponent","screenPosition","worldToScreen","rgd","x","y","normalize","shootPower","clone","linearVelocity","keyCode","landminefireInterval","putlandmine","landminePrefab"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, systemEvent, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, AudioSource, director, CameraComponent, Camera } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { PlayerController0 } from './tank0';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('playerfire')\r\nexport class playerfire extends Component {\r\n    @property(AudioSource)\r\n    private shootAudio: AudioSource = null;\r\n\r\n    @property\r\n    shootPower:number=500;//子弹的发射速度\r\n\r\n    //子弹发射间隔\r\n    lastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    fireInterval: number = 1; // 发射间隔时间，单位秒\r\n\r\n    //地雷发射间隔\r\n    landminelastFireTime: number = 0; // 上次发射时间\r\n    @property\r\n    landminefireInterval: number = 2; // 发射间隔时间，单位秒\r\n\r\n\r\n    @property(Prefab)\r\n    bulletPrefab: Prefab = null;\r\n\r\n    @property(Prefab)\r\n    landminePrefab: Prefab = null;\r\n\r\n    @property(Node)\r\n    Carmera: Node = null;\r\n\r\n    direction: Vec2 = new Vec2(0, 0);\r\n    lastdirection: Vec2 = new Vec2(0, -400);\r\n    speed: Vec2 = new Vec2(0, 0);\r\n\r\n    fireposition: Vec2 = new Vec2(0, 0);\r\n\r\n    static fireInterval: number;\r\n\r\n    private playercontroller0: PlayerController0 = null;\r\n\r\n\r\n    start() {\r\n        input.on(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        input.on(Input.EventType.MOUSE_MOVE, this.onMouseMove, this);\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown0, this);\r\n\r\n    }\r\n\r\n    update() {\r\n    }\r\n    onDestroy() {\r\n        input.off(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown0, this);\r\n    }\r\n\r\n    private onMouseMove(event) {\r\n        this.fireposition = event.getLocation();\r\n    }\r\n\r\n    private onMouseDown(event: EventMouse) {\r\n        if (event.getButton() === 0) {\r\n\r\n            const now = Date.now();\r\n            if (now - this.lastFireTime > this.fireInterval * 1000) {\r\n                this.fireBullet();\r\n                this.lastFireTime = now;\r\n                //this.fireposition=event.getLocation();\r\n            }\r\n        }\r\n    }\r\n\r\n    private fireBullet() {\r\n\r\n        const bullet = instantiate(this.bulletPrefab);\r\n\r\n        //音效模块\r\n        if (this.shootAudio && this.shootAudio.clip) {\r\n            // ������Ч\r\n            this.shootAudio.playOneShot(this.shootAudio.clip, 1);\r\n        } else {\r\n            console.error('��ƵԴ�������Ƶ����δ����');\r\n        }\r\n        //音效模块\r\n\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //鼠标的屏幕坐标获取\r\n        let worldPosition = this.node.getWorldPosition();\r\n        let Camera0 = this.Carmera.getComponent(CameraComponent);\r\n        let screenPosition = new Vec3();\r\n        Camera0.worldToScreen(worldPosition, screenPosition);\r\n\r\n        const rgd = bullet.getComponent(RigidBody2D);\r\n        this.speed = new Vec2((this.fireposition.x - screenPosition.x), (this.fireposition.y - screenPosition.y));\r\n        this.speed.normalize();\r\n        this.speed.x = this.speed.x * this.shootPower;\r\n        this.speed.y = this.speed.y * this.shootPower;\r\n\r\n        if (this.speed.x !== 0 || this.speed.y !== 0) {\r\n\r\n            this.lastdirection = this.speed;\r\n        }\r\n        if (this.speed.x === 0 && this.speed.y === 0) {\r\n\r\n            this.speed = this.lastdirection.clone();\r\n        }\r\n        rgd.linearVelocity = this.speed;\r\n    }\r\n\r\n    //���k�Ƿ���  �������\r\n    private onKeyDown0(event: EventKeyboard) {\r\n        if (event.keyCode === 70) {\r\n            const now = Date.now();\r\n            if (now - this.landminelastFireTime > this.landminefireInterval * 1000) {\r\n                this.putlandmine();\r\n                this.landminelastFireTime = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    private putlandmine() {\r\n        const bullet = instantiate(this.landminePrefab);\r\n        bullet.setParent(this.node);\r\n        bullet.setPosition(this.node.position);\r\n\r\n        //�����ӵ�ʵ���ľ�������\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}