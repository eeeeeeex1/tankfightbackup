{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/enemytank/enemytank.ts"],"names":["_decorator","Component","SpriteFrame","RigidBody2D","Vec3","Collider2D","Contact2DType","Vec2","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","Directions","enemytank","direction","tanklife","intervalInSeconds","currentspeed","lastChangeTime","timer","lastPosition","EPSILON","pressedKeys","spreadspeed","aitankspeed","lastspeed","sign","signtimer","speedmonitor","speedtime","speedtimer","speedtimermonitor","onLoad","node","position","Date","now","start","changeDirection","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","update","dt","player","parent","getChildByName","Math","abs","x","y","normalize","set","console","log","destroy","selfCollider","otherCollider","newDirection","floor","random","newVelocity","clone","multiplyScalar","speed","rigidBody","linearVelocity"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate, Collider2D, Contact2DType } from 'cc';\r\nimport { Vec2 } from 'cc';\r\n//import { Bullet } from './Bullet'; // 假设 Bullet 脚本的文件路径和类名为 Bullet\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n//可以实现tank的万向追踪和子弹的万向发射\r\n//enemytank的0.0版\r\n//困难的敌人\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1, 1),\r\n    UPRIGHT: new Vec2(1, 1),\r\n    DOWNLEFT: new Vec2(-1, -1),\r\n    DOWNRIGHT: new Vec2(1, -1)\r\n};\r\n\r\nconst Directions = [\r\n    new Vec2(-1, 0),  // LEFT\r\n    new Vec2(1, 0),   // RIGHT\r\n    new Vec2(0, 1),   // UP\r\n    new Vec2(0, -1),  // DOWN\r\n];\r\n\r\n@ccclass('enemytank')\r\nexport class enemytank extends Component {\r\n\r\n    //加速的倍率\r\n    @property\r\n    public magnification: number = 5;\r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n    @property(SpriteFrame)\r\n    private speed: number = 2;\r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n    //坦克生命值\r\n    tanklife: number = 5;\r\n    intervalInSeconds: number = 5;\r\n    currentspeed: Vec2 = new Vec2(0, 0);\r\n\r\n\r\n    private lastChangeTime: number; // 上次位置改变的时间戳\r\n    private timer: number; // 累计经过的时间\r\n\r\n    private lastPosition: Vec3 = new Vec3();\r\n    private readonly EPSILON: number = 0.0001;\r\n    pressedKeys: any;\r\n    spreadspeed: Vec2 = new Vec2(0, 0);\r\n    aitankspeed: Vec2;\r\n\r\n    private lastspeed: Vec2 = new Vec2(0, 0);\r\n    sign: number = 0;\r\n    signtimer: number = 0;\r\n\r\n    speedmonitor : Vec2 = new Vec2(0,0);\r\n    speedtime : number = 0;\r\n    speedtimer : number = 0;\r\n    speedtimermonitor :number = 0;\r\n\r\n\r\n\r\n    onLoad() {\r\n        this.lastPosition = this.node.position; // 初始化上次记录的位置为当前位置\r\n        this.lastChangeTime = Date.now(); // 初始化上次位置改变的时间戳为当前时间\r\n        this.timer = 0; // 初始化计时器为0\r\n    }\r\n\r\n    start() {\r\n        //console.log('生成enemytank');\r\n        this.aitankspeed = new Vec2(0, 0);\r\n        this.changeDirection();\r\n\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n\r\n        // 初始化\r\n        this.speedtimer = 0;\r\n        this.speedmonitor = this.currentspeed; // 初始化监视速度\r\n    }\r\n\r\n    update(dt: number) {\r\n        // 检测位置是否改变\r\n\r\n        const player = this.node.parent.getChildByName('playertank');\r\n        if(player){\r\n            if((Math.abs(this.node.position.x - player.position.x) < 100 || Math.abs(this.node.position.y - player.position.y) < 100)&&this.sign===0) {\r\n                this.aitankspeed.x = player.position.x - this.node.position.x;\r\n                this.aitankspeed.y = player.position.y - this.node.position.y;\r\n                this.aitankspeed.normalize();\r\n                this.changeDirection(); // 调用函数\r\n            }\r\n\r\n            else {\r\n                if (this.node.position.x - this.lastPosition.x > this.EPSILON || this.node.position.y - this.lastPosition.y > this.EPSILON) {\r\n                    // console.log('位置改变');\r\n                    this.lastPosition.set(this.node.position); // 更新记录的位置\r\n                    this.lastChangeTime = Date.now(); // 更新位置改变的时间戳\r\n                    this.timer = 0; // 重置计时器\r\n                }\r\n                else {\r\n                    this.timer += dt;\r\n                    // 检查是否超过2秒\r\n                    if (this.timer >= 3) {\r\n                        this.timer = 0; // 重置计时器\r\n                        this.changeDirection(); // 调用函数\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n        else {\r\n            console.log('失败');\r\n            this.node.destroy();\r\n        }\r\n\r\n\r\n        //碰撞速度修改检测\r\n        if (this.sign === 1) {\r\n            this.signtimer += dt;\r\n            // 检查是否超过2秒\r\n            if (this.signtimer >= 2) {\r\n                this.signtimer = 0; // 重置计时器\r\n                this.sign = 0; \r\n                this.changeDirection() ;\r\n                //console.log('调整完毕');\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D) {\r\n        //console.log('碰撞');\r\n        this.sign = 1;\r\n        this.changeDirection(); // 自定义方法，用于改变坦克的移动方向\r\n\r\n    }\r\n\r\n    changeDirection() {\r\n\r\n        let newDirection = Math.floor(Math.random() * 4); // 假设有四个方向\r\n        while (this.lastspeed.x === Directions[newDirection].x && this.lastspeed.y === Directions[newDirection].y) {\r\n            newDirection = Math.floor(Math.random() * 4);\r\n        }\r\n\r\n        if ((this.aitankspeed.x !== 0 || this.aitankspeed.y !== 0) && this.sign===0) {\r\n            let newVelocity = this.aitankspeed.clone().multiplyScalar(this.speed);\r\n            //给坦克赋值速度\r\n            this.rigidBody.linearVelocity = newVelocity;\r\n            //传递速度到fire\r\n            this.currentspeed = newVelocity;\r\n\r\n        }\r\n\r\n        else {\r\n\r\n            let newVelocity = Directions[newDirection].clone().multiplyScalar(this.speed);\r\n            this.rigidBody.linearVelocity = newVelocity;\r\n            this.currentspeed = newVelocity;\r\n\r\n            this.lastspeed = Directions[newDirection].clone();\r\n        }\r\n    }\r\n}"]}