{"version":3,"sources":["file:///D:/TankFight/TK2/assets/text/tank0.ts"],"names":["_decorator","Component","SpriteFrame","Input","input","macro","RigidBody2D","Vec2","firedirection0","ccclass","property","Direction","LEFT","RIGHT","UP","DOWN","UPLEFT","UPRIGHT","DOWNLEFT","DOWNRIGHT","PlayerController0","moveSpeed","direction","pressedKeys","Set","currentDirection","ZERO","tanklife","Error","start","on","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","upSpriteFrame","downSpriteFrame","leftSpriteFrame","rightSpriteFrame","updateSpriteFrame","onDestroy","off","event","has","keyCode","add","updateDirection","delete","newDirection","KEY","w","s","a","d","equals","updateVelocity","stopMove","velocity","clone","multiplyScalar","magnification","rigidBody","linearVelocity","firedirection","getComponentInChildren","spriteNode","node","getChildByName","sprite","getComponent","cc","Sprite","spriteFrame","rightanddownSpriteFrame","rightandupSpriteFrame","leftanddownSpriteFrame","leftandupSpriteFrame"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab,Sprite, systemEvent, SpriteFrame, Input, input, EventMouse, SystemEvent, Node, EventKeyboard, macro, RigidBody2D, Vec3, instantiate } from 'cc';\r\nimport { firedirection0 } from './firedirection0'; // 确保正确引入 firedirection0 类\r\nimport { Vec2 } from 'cc';\r\n//import { Bullet } from './Bullet'; // 假设 Bullet 脚本的文件路径和类名为 Bullet\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n// 定义方向向量\r\nconst Direction = {\r\n    LEFT: new Vec2(-1, 0),\r\n    RIGHT: new Vec2(1, 0),\r\n    UP: new Vec2(0, 1),\r\n    DOWN: new Vec2(0, -1),\r\n    UPLEFT: new Vec2(-1,1),\r\n    UPRIGHT: new Vec2(1,1),\r\n    DOWNLEFT: new Vec2(-1,-1),\r\n    DOWNRIGHT: new Vec2(1,-1)\r\n\r\n};\r\n\r\n@ccclass('PlayerController0')\r\nexport class PlayerController0 extends Component {\r\n    static currentDirection(currentDirection: any) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n\r\n    //加速的倍率\r\n    @property\r\n    public magnification: number =1;\r\n\r\n    \r\n\r\n    @property(RigidBody2D)\r\n    rigidBody: RigidBody2D = null;\r\n\r\n    @property(SpriteFrame)\r\n    private upSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private downSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private rightanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftandupSpriteFrame: SpriteFrame | null = null;\r\n\r\n    @property(SpriteFrame)\r\n    private leftanddownSpriteFrame: SpriteFrame | null = null;\r\n\r\n    moveSpeed: number = 1; // 调整移动速度\r\n\r\n\r\n    private direction: Vec2 = new Vec2(0, 0);\r\n    private pressedKeys: Set<number> = new Set<number>();\r\n    currentDirection: Vec2 = Vec2.ZERO;\r\n    //坦克生命值\r\n    tanklife: number = 5;\r\n\r\n    //子弹发射的间隔\r\n\r\n\r\n\r\n    start() {\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        if (this.upSpriteFrame && this.downSpriteFrame && this.leftSpriteFrame && this.rightSpriteFrame) {\r\n            this.updateSpriteFrame();\r\n        }\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n    }\r\n\r\n\r\n    //运动实现模块\r\n    private onKeyDown(event: EventKeyboard) {\r\n        if (!this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.add(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n\r\n    }\r\n\r\n    private onKeyUp(event: EventKeyboard) {\r\n        if (this.pressedKeys.has(event.keyCode)) {\r\n            this.pressedKeys.delete(event.keyCode);\r\n            this.updateDirection();\r\n        }\r\n    }\r\n\r\n    private updateDirection(): void {\r\n        let newDirection = new Vec2(0, 0);\r\n        if (this.pressedKeys.has(macro.KEY.w)) {\r\n            newDirection.add(Direction.UP);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.s)) {\r\n            newDirection.add(Direction.DOWN);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.a)) {\r\n            newDirection.add(Direction.LEFT);\r\n        }\r\n        if (this.pressedKeys.has(macro.KEY.d)) {\r\n            newDirection.add(Direction.RIGHT);\r\n        }\r\n\r\n        if (!newDirection.equals(this.currentDirection)) {\r\n            this.currentDirection = newDirection;\r\n            this.updateVelocity();\r\n            this.updateSpriteFrame();\r\n        } else if (newDirection.equals(new Vec2(0, 0))) {\r\n            this.stopMove();\r\n        }\r\n    }\r\n\r\n    private updateVelocity() {\r\n        //计算归一化的速度方向向量\r\n        let velocity = this.currentDirection.clone().multiplyScalar(this.moveSpeed);\r\n\r\n        velocity.multiplyScalar(this.magnification);\r\n        if (this.rigidBody) {\r\n            this.rigidBody.linearVelocity = velocity;\r\n        }\r\n    }\r\n\r\n\r\n    private stopMove() {\r\n        if (!this.currentDirection.equals(Vec2.ZERO)) {\r\n            this.currentDirection = Vec2.ZERO;\r\n            this.rigidBody.linearVelocity = Vec2.ZERO;\r\n        }\r\n    }\r\n\r\n\r\n    private updateSpriteFrame(): void {\r\n        const firedirection:firedirection0 = this.getComponentInChildren(firedirection0);\r\n        const spriteNode = this.node.getChildByName('RenderSprite0');\r\n        const sprite = spriteNode ? spriteNode.getComponent(cc.Sprite) as cc.Sprite : null;\r\n        if (sprite) {\r\n            switch (true) {\r\n                case this.currentDirection.equals(Direction.UP):\r\n                    sprite.spriteFrame = this.upSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWN):\r\n                    sprite.spriteFrame = this.downSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.LEFT):\r\n                    sprite.spriteFrame = this.leftSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.RIGHT):\r\n                    sprite.spriteFrame = this.rightSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNRIGHT):\r\n                    sprite.spriteFrame = this.rightanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPRIGHT):\r\n                    sprite.spriteFrame = this.rightandupSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.DOWNLEFT):\r\n                    sprite.spriteFrame = this.leftanddownSpriteFrame;\r\n                    break;\r\n                case this.currentDirection.equals(Direction.UPLEFT):\r\n                    sprite.spriteFrame = this.leftandupSpriteFrame;\r\n                    break;\r\n                default:\r\n                    // 默认情况下，可以保持原状或设置为静止状态的纹理\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n"]}